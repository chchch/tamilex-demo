"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@psychobolt/react-paperjs");function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}function p(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?p(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):p(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?h(e):t}function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,n=l(e);if(t){var r=l(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return d(this,o)}}var P,g,w,y=function(t){u(r,e.Component);var n=v(r);function r(){var e;o(this,r);for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return(e=n.call.apply(n,[this].concat(a))).path=void 0,e}return r}();y.defaultProps={onKeyDown:function(){},onKeyUp:function(){},onMouseDown:function(){},onMouseDrag:function(){},onMouseUp:function(){},onPathInit:function(){},onPathAdd:function(){},onSegmentAdd:function(){},onSegmentRemove:function(){}};var M,m,D,b,S,k,R,O,U,A,j,E,C,x,K,T,I,_,z=t.Tool,W=t.PaperScope,B=W((w=g=function(t){u(a,y);var n=v(a);function a(){var e;o(this,a);for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return(e=n.call.apply(n,[this].concat(r))).onMouseDown=function(t){var o=e.props,n=o.pathProps,r=o.onMouseDown,a=o.onPathInit,s=o.paper;if(0===t.event.button){var p=new s.Path(n);e.path=p,a(p)}r(t)},e.onMouseDrag=function(t){var o=e.props.onMouseDrag;1===t.event.buttons&&e.path.add(t.point),o(t)},e.onMouseUp=function(t){var o=h(e).path,n=e.props,r=n.onMouseUp,a=n.onPathAdd;o&&(a(o),e.path=null),r(t)},e}return r(a,[{key:"render",value:function(){var t=this.props,o=(t.pathProps,t.onMouseDown,t.onMouseDrag,t.onMouseUp,t.onPathAdd,t.paper,t.innerRef),n=f(t,["pathProps","onMouseDown","onMouseDrag","onMouseUp","onPathAdd","paper","innerRef"]);return e.createElement(z,s({ref:o,minDistance:10,onMouseDown:this.onMouseDown,onMouseDrag:this.onMouseDrag,onMouseUp:this.onMouseUp},n))}}]),a}(),g.defaultProps=i(i({},y.defaultProps),{},{pathProps:{strokeColor:"black"}}),P=w))||P,L=e.forwardRef((function(t,o){return e.createElement(B,s({innerRef:o},t))})),F=t.Layer,q=t.Group,G=t.Line,Z=function(t){for(var o=t.width,n=t.height,r=t.top,a=void 0===r?0:r,s=t.left,p=void 0===s?0:s,i=t.right,u=void 0===i?p+o:i,l=t.bottom,c=void 0===l?a+n:l,f=t.cellSize,h=void 0===f?50:f,d=t.strokeColor,v=void 0===d?"#D0D0D0":d,P=t.strokeWidth,g=void 0===P?1:P,w=t.innerRef,y=Math.ceil(p/h)*h,M=Math.ceil(a/h)*h,m=Math.ceil((u-p)/h),D=Math.ceil((c-a)/h),b=[],S=[],k=0;k<=m;k+=1){var R=y+k*h;b.push(e.createElement(G,{key:k,from:[R,a],to:[R,c],strokeColor:v,strokeWidth:g}))}for(var O=0;O<=D;O+=1){var U=M+O*h;S.push(e.createElement(G,{key:O,from:[p,U],to:[u,U],strokeColor:v,strokeWidth:g}))}return e.createElement(F,{ref:w},e.createElement(q,null,b),e.createElement(q,null,S))},$=e.forwardRef((function(t,o){return e.createElement(Z,s({innerRef:o},t))})),Y=t.Tool,H=t.PaperScope,J=H((D=m=function(t){u(a,y);var n=v(a);function a(){var e;o(this,a);for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return(e=n.call.apply(n,[this].concat(r))).onMouseDown=function(t){var o=e.props,n=o.pathProps,r=o.onMouseDown,a=o.onPathInit,s=o.paper;if(0===t.event.button){var p=new s.Path(n);p.add(t.point),e.path=p,a(p)}r(t)},e.onMouseDrag=function(t){var o=h(e).path,n=e.props.onMouseDrag;1===t.event.buttons&&(o.removeSegment(1),o.addSegment(t.point),o.selected=!0),n(t)},e.onMouseUp=function(t){var o=h(e).path,n=e.props,r=n.onMouseUp,a=n.onPathAdd;o&&(o.selected=!1,a(o),e.path=null),r(t)},e}return r(a,[{key:"render",value:function(){var t=this.props,o=(t.pathProps,t.onMouseDown,t.onMouseDrag,t.onMouseUp,t.onPathAdd,t.innerRef),n=f(t,["pathProps","onMouseDown","onMouseDrag","onMouseUp","onPathAdd","innerRef"]);return e.createElement(Y,s({ref:o,onMouseDown:this.onMouseDown,onMouseDrag:this.onMouseDrag,onMouseUp:this.onMouseUp},n))}}]),a}(),m.defaultProps=i(i({},y.defaultProps),{},{pathProps:{strokeColor:"black"}}),M=D))||M,N=e.forwardRef((function(t,o){return e.createElement(J,s({innerRef:o},t))})),Q=t.Tool,V=t.PaperScope,X=V((k=S=function(t){u(a,y);var n=v(a);function a(){var e;o(this,a);for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return(e=n.call.apply(n,[this].concat(r))).onMouseDown=function(t){if(0===t.event.button){var o=h(e).path;o||(e.pathInit(),e.props.onPathInit(o)),null==e.selectedSegment?e.onSegmentAdd(t):e.onPathAdd()}e.props.onMouseDown(t)},e.points=void 0,e.selectedSegment=void 0,e}return r(a,[{key:"componentDidUpdate",value:function(){var e=this.path,t=this.points,o=this.props,n=o.pathProps,r=o.pathData;e?(this.setPathData(r),Object.assign(e,n)):t&&this.pathInit()}},{key:"pathInit",value:function(){var e=this.props,t=e.pathProps,o=e.pathData,n=new(0,e.paper.Path)(t);this.path=n,this.setPathData(o)}},{key:"setPathData",value:function(e){var t=this,o=this.path;this.removeBounds(),o.pathData=e,o.segments.forEach((function(e){return t.createBounds(e)}))}},{key:"onSegmentAdd",value:function(e){var t=this.path;t.add(e.point);var o=t.lastSegment;this.createBounds(o),this.props.onSegmentAdd(o,t)}},{key:"onPathAdd",value:function(){var e=this.selectedSegment,t=this.path,o=this.points,n=this.props,r=n.onSegmentRemove,a=n.onPathAdd,s=e.index,p=t.removeSegments(0,s);p.length&&r(p,t),t.closed=!0,t.selected=!1,a(t),this.path=null,this.selectedSegment=null,o&&o.remove()}},{key:"createBounds",value:function(e){var t=this,o=this.props.paper,n=o.Path,r=o.Group,a=o.project,s=this.path;this.points||(this.points=new r,a.layers.$$metadata.addChild(this.points));var p=new n.Circle({center:e.point,radius:7,fillColor:"white",opacity:0});p.on("mousedown",(function(){s.closed||s.lastSegment.point.equals(p.position)||!s.contains(p.position)||(t.selectedSegment=e)})),this.points.addChild(p)}},{key:"removeBounds",value:function(){this.points&&(this.points.remove(),this.points=null)}},{key:"render",value:function(){var t=this.props,o=(t.pathProps,t.onMouseDown,t.onPathAdd,t.onSegmentAdd,t.onSegmentRemove,t.paper,t.innerRef),n=f(t,["pathProps","onMouseDown","onPathAdd","onSegmentAdd","onSegmentRemove","paper","innerRef"]);return e.createElement(Q,s({ref:o,onMouseDown:this.onMouseDown},n))}}]),a}(),S.defaultProps=i(i({},y.defaultProps),{},{pathProps:{strokeColor:"black",selected:!0}}),b=k))||b,ee=e.forwardRef((function(t,o){return e.createElement(X,s({innerRef:o},t))})),te=t.Tool,oe=t.PaperScope,ne=oe((U=O=function(t){u(a,y);var n=v(a);function a(){var e;o(this,a);for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return(e=n.call.apply(n,[this].concat(r))).onMouseDown=function(t){var o=e.props,n=o.pathProps,r=o.onMouseDown,a=o.onPathInit,s=o.paper;if(0===t.event.button){var p=s.Path,i=s.Color,u=t.point,l=new p.Rectangle({point:u,size:[1,1],fillColor:n.selectedFillColor||new i(.9,.9,1,.75),selected:!0});e.path=l,e.start=u,a(l)}r(t)},e.onMouseDrag=function(t){var o=e.props.onMouseDrag;if(1===t.event.buttons){var n=h(e),r=n.path,a=n.start,s=r.bounds,p=t.point.subtract(a),i=Math.abs(p.x),u=Math.abs(p.y);p.x<0?(s.left=t.point.x,s.right=a.x):s.left=a.x,p.y>0?(s.top=a.y,s.bottom=t.point.y):s.top=t.point.y,i>0&&(s.width=i),u>0&&(s.height=u)}o(t)},e.onMouseUp=function(t){var o=h(e).path,n=e.props,r=n.pathProps,a=n.onMouseUp,s=n.onPathAdd;o&&(Object.assign(o,i({selected:!1},r)),s(o),e.path=null,e.start=null),a(t)},e.start=void 0,e}return r(a,[{key:"render",value:function(){var t=this.props,o=t.innerRef,n=f(t,["innerRef"]);return e.createElement(te,s({},n,{ref:o,onMouseDown:this.onMouseDown,onMouseDrag:this.onMouseDrag,onMouseUp:this.onMouseUp}))}}]),a}(),O.defaultProps=i(i({},y.defaultProps),{},{pathProps:{fillColor:"white",strokeColor:"black"}}),R=U))||R,re=e.forwardRef((function(t,o){return e.createElement(ne,s({innerRef:o},t))})),ae=t.Tool,se=t.PaperScope,pe=se((E=j=function(t){u(a,y);var n=v(a);function a(){var e;o(this,a);for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return(e=n.call.apply(n,[this].concat(r))).onMouseDown=function(t){var o=e.props,n=o.pathProps,r=o.onMouseDown,a=o.onPathInit,s=o.paper;if(0===t.event.button){var p=s.Path,i=s.Color,u=new p.Circle({center:t.point,radius:1,fillColor:n.selectedFillColor||new i(.9,.9,1,.75),selected:!0});e.path=u,a(u)}r(t)},e.onMouseDrag=function(t){var o=e.props.onMouseDrag;if(1===t.event.buttons){var n=h(e).path,r=Math.abs(t.point.getDistance(n.position)/(n.bounds.width/2));r>.1&&n.scale(r)}o(t)},e.onMouseUp=function(t){var o=h(e).path,n=e.props,r=n.pathProps,a=n.onMouseUp,s=n.onPathAdd;o&&(Object.assign(o,i({selected:!1},r)),s(o),e.path=null),a(t)},e}return r(a,[{key:"render",value:function(){var t=this.props,o=t.innerRef,n=f(t,["innerRef"]);return e.createElement(ae,s({ref:o},n,{onMouseDown:this.onMouseDown,onMouseDrag:this.onMouseDrag,onMouseUp:this.onMouseUp}))}}]),a}(),j.defaultProps=i(i({},y.defaultProps),{},{pathProps:{fillColor:"white",strokeColor:"black"}}),A=E))||A,ie=e.forwardRef((function(t,o){return e.createElement(pe,s({innerRef:o},t))})),ue=t.Tool,le=t.PaperScope,ce=le((K=x=function(t){u(a,y);var n=v(a);function a(){var e;o(this,a);for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return(e=n.call.apply(n,[this].concat(r))).onKeyUp=function(){var t=h(e),o=t.path,n=t.onPathAdd;o&&(o.segments.length>1?n():(o.remove(),e.path=null))},e.onMouseDown=function(t){var o=h(e).path;0===t.event.button&&t.modifiers.shift&&(o||(e.pathInit(),e.props.onPathInit(o)),e.onSegmentAdd(t)),e.props.onMouseDown(t)},e.onPathAdd=function(){var t=h(e).path,o=e.props.onPathAdd;t.selected=!1,o(t),e.path=null},e}return r(a,[{key:"pathInit",value:function(){var e=this.props,t=e.pathProps,o=e.pathData,n=new(0,e.paper.Path)(t);this.path=n,this.setPathData(o)}},{key:"setPathData",value:function(e){this.path.pathData=e}},{key:"onSegmentAdd",value:function(e){var t=this.path;t.add(e.point),this.props.onSegmentAdd(t.lastSegment,t)}},{key:"render",value:function(){var t=this.props,o=(t.pathProps,t.onKeyUp,t.onMouseDown,t.onPathAdd,t.onSegmentAdd,t.onSegmentRemove,t.paper,t.innerRef),n=f(t,["pathProps","onKeyUp","onMouseDown","onPathAdd","onSegmentAdd","onSegmentRemove","paper","innerRef"]);return e.createElement(ue,s({ref:o,onKeyUp:this.onKeyUp,onMouseDown:this.onMouseDown},n))}}]),a}(),x.defaultProps=i(i({},y.defaultProps),{},{pathProps:{strokeColor:"black",selected:!0}}),C=K))||C,fe=e.forwardRef((function(t,o){return e.createElement(ce,s({innerRef:o},t))})),he=t.PaperScope,de=t.getProps;function ve(e,t){return(10*e+10*t)/10}function Pe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return function(t){return e.forEach((function(e){return e&&e(t)}))}}var ge,we,ye,Me=he((_=I=function(t){u(a,e.Component);var n=v(a);function a(e){var t;return o(this,a),(t=n.call(this,e)).onWheel=function(e){var o=e.deltaY,n=t.props,r=n.onZoom;(0,n.mergeProps)((function(e,t){var n=e.viewProps.zoom;return o<0?(n=ve(n,.1),r&&r(n),{viewProps:i(i(i({},t.viewProps),e.viewProps),{},{zoom:n})}):o>0&&n>.1?(n=ve(n,-.1),r&&r(n),{viewProps:i(i(i({},t.viewProps),e.viewProps),{},{zoom:n})}):null}))},t.onKeyDown=function(e){var o=e.key,n=t.state.draggable;if("space"===o&&!n){var r=t.props,a=r.onPanEnabled;(0,r.mergeProps)((function(e,t){return i(i({},e),{},{canvasProps:i(i(i({},t.canvasProps),e.canvasProps),{},{"drag-state":"enabled"})})})),t.setState({draggable:!0}),a&&a()}},t.onKeyUp=function(e){if("space"===e.key){var o=t.props,n=o.onPanDisabled;(0,o.mergeProps)((function(e,t){return i(i({},e),{},{canvasProps:i(i(i({},t.canvasProps),e.canvasProps),{},{"drag-state":"disabled"})})})),t.setState({draggable:!1}),n&&n()}},t.onMouseDown=function(e){var o=e.point,n=t.state,r=n.draggable,a=n.dragStart;r&&!a&&((0,t.props.mergeProps)((function(e,t){return i(i({},e),{},{canvasProps:i(i(i({},t.canvasProps),e.canvasProps),{},{"drag-state":"dragging"})})})),t.setState({dragStart:o}))},t.onMouseUp=function(){var e=t.state,o=e.dragStart,n=e.draggable;if(o){if(n)(0,t.props.mergeProps)((function(e,t){return i(i({},e),{},{canvasProps:i(i(i({},t.canvasProps),e.canvasProps),{},{"drag-state":"enabled"})})}));t.setState({dragStart:null})}},t.onMouseDrag=function(e){var o=e.point,n=t.props,r=n.mergeProps,a=n.paper,s=t.state,p=s.draggable,u=s.dragStart;r((function(e,t){return u?{viewProps:i(i(i({},t.viewProps),e.viewProps),{},{center:a.view.center.add(o.subtract(u).multiply(.5))})}:null})),p&&t.setState({dragStart:o})},t.state={draggable:!1,dragStart:null},t}return r(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props,o=t.paper,n=t.zoomLevel,r=t.center;(0,t.mergeProps)((function(t,a){var s=de(o,a.canvasProps),p=s.onWheel,u=f(s,["onWheel"]),l=de(o,a.viewProps),c=l.onKeyDown,h=l.onKeyUp,d=l.onMouseDown,v=l.onMouseDrag,P=l.onMouseUp,g=f(l,["onKeyDown","onKeyUp","onMouseDown","onMouseDrag","onMouseUp"]);return{canvasProps:i(i({},u),{},{onWheel:Pe([p,e.onWheel]),"drag-state":"disabled"}),viewProps:i(i({},g),{},{onKeyDown:Pe([c,e.onKeyDown]),onKeyUp:Pe([h,e.onKeyUp]),onMouseDown:Pe([d,e.onMouseDown]),onMouseDrag:Pe([v,e.onMouseDrag]),onMouseUp:Pe([P,e.onMouseUp]),zoom:n,center:r})}}))}},{key:"render",value:function(){return this.props.children}}]),a}(),I.defaultProps={zoomLevel:1,onPanEnabled:function(){},onPanDisabled:function(){},onZoom:function(){}},T=_))||T,me=t.Tool,De=t.PaperScope,be=De((ye=we=function(t){u(a,y);var n=v(a);function a(){var e;o(this,a);for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return(e=n.call.apply(n,[this].concat(r))).onMouseDown=function(t){var o=e.props,n=o.pathProps,r=o.onMouseDown,a=o.onPathInit,s=o.paper;if(0===t.event.button){var p=s.Path,i=s.Color,u=t.point,l=new p.Ellipse({point:u,size:[1,1],fillColor:n.selectedFillColor||new i(.9,.9,1,.75),selected:!0});e.path=l,e.start=u,a(e.path)}r(t)},e.onMouseDrag=function(t){var o=e.props.onMouseDrag;if(1===t.event.buttons){var n=h(e),r=n.path,a=n.start,s=r.bounds,p=t.point.subtract(a),i=Math.abs(p.x),u=Math.abs(p.y);p.x<0?(s.left=t.point.x,s.right=a.x):s.left=a.x,p.y>0?(s.top=a.y,s.bottom=t.point.y):s.top=t.point.y,i>0&&(s.width=i),u>0&&(s.height=u)}o(t)},e.onMouseUp=function(t){var o=h(e).path,n=e.props,r=n.pathProps,a=n.onMouseUp,s=n.onPathAdd;o&&(Object.assign(o,i({selected:!1},r)),s(o),e.path=null,e.start=null),a(t)},e.start=void 0,e}return r(a,[{key:"render",value:function(){var t=this.props,o=t.innerRef,n=f(t,["innerRef"]);return e.createElement(me,s({},n,{ref:o,onMouseDown:this.onMouseDown,onMouseDrag:this.onMouseDrag,onMouseUp:this.onMouseUp}))}}]),a}(),we.defaultProps=i(i({},y.defaultProps),{},{pathProps:{fillColor:"white",strokeColor:"black"}}),ge=ye))||ge,Se=e.forwardRef((function(t,o){return e.createElement(be,s({innerRef:o},t))}));exports.CircleTool=ie,exports.EllipseTool=Se,exports.FreeformPathTool=L,exports.Grid=$,exports.LineTool=N,exports.PanAndZoom=Me,exports.PathTool=y,exports.PolygonTool=ee,exports.RectangleTool=re,exports.SegmentPathTool=fe;
